// Enhanced Achievement Dashboard Component\n// Comprehensive achievement management interface with real-time updates\n\nimport React, { useState, useEffect } from 'react';\nimport { \n  Trophy, \n  Star, \n  Flame, \n  Target, \n  Medal, \n  Zap, \n  TrendingUp,\n  Award,\n  Calendar,\n  Clock,\n  Users,\n  ChevronRight,\n  RefreshCw,\n  AlertCircle,\n  CheckCircle,\n  Eye,\n  EyeOff\n} from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Separator } from '@/components/ui/separator';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { useToast } from '@/components/ui/use-toast';\nimport useAchievements from '@/hooks/useAchievements';\nimport { ApiErrorHandler } from '@/services/ApiErrorHandler';\nimport type { Achievement, UserAchievement, Quest } from '@/services/enhancedAchievementApi';\n\ninterface AchievementCardProps {\n  achievement: Achievement | UserAchievement;\n  isEarned?: boolean;\n  onShowcase?: (id: number, showcase: boolean) => void;\n  isShowcasing?: boolean;\n}\n\nconst AchievementCard: React.FC<AchievementCardProps> = ({ \n  achievement, \n  isEarned = false, \n  onShowcase,\n  isShowcasing = false\n}) => {\n  const achievementData = 'achievement' in achievement ? achievement.achievement : achievement;\n  const userAchievement = 'achievement' in achievement ? achievement : null;\n  \n  const tierColors = {\n    bronze: 'text-amber-600 bg-amber-50',\n    silver: 'text-gray-600 bg-gray-50',\n    gold: 'text-yellow-600 bg-yellow-50',\n    platinum: 'text-purple-600 bg-purple-50',\n    diamond: 'text-blue-600 bg-blue-50'\n  };\n  \n  const rarityColors = {\n    common: 'border-gray-300',\n    uncommon: 'border-green-400',\n    rare: 'border-blue-400',\n    epic: 'border-purple-400',\n    legendary: 'border-yellow-400'\n  };\n\n  return (\n    <Card className={`relative transition-all hover:shadow-md ${\n      rarityColors[achievementData.rarity as keyof typeof rarityColors] || 'border-gray-300'\n    } ${isEarned ? 'bg-gradient-to-br from-green-50 to-emerald-50' : ''}`}>\n      {isEarned && (\n        <div className=\"absolute -top-2 -right-2 bg-green-500 text-white rounded-full p-1\">\n          <CheckCircle className=\"h-4 w-4\" />\n        </div>\n      )}\n      \n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 rounded-full bg-gradient-to-br from-orange-100 to-amber-100\">\n              <Trophy className=\"h-6 w-6 text-orange-600\" />\n            </div>\n            <div>\n              <CardTitle className=\"text-sm font-semibold\">{achievementData.title}</CardTitle>\n              <CardDescription className=\"text-xs\">\n                {achievementData.category} • {achievementData.tier}\n              </CardDescription>\n            </div>\n          </div>\n          \n          <Badge variant=\"outline\" className={tierColors[achievementData.tier as keyof typeof tierColors]}>\n            {achievementData.points} pts\n          </Badge>\n        </div>\n      </CardHeader>\n      \n      <CardContent className=\"space-y-3\">\n        <p className=\"text-sm text-gray-600 leading-relaxed\">\n          {achievementData.description}\n        </p>\n        \n        {isEarned && userAchievement && (\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between text-xs text-gray-500\">\n              <span>Earned {new Date(userAchievement.earned_at).toLocaleDateString()}</span>\n              {userAchievement.times_earned > 1 && (\n                <span>×{userAchievement.times_earned}</span>\n              )}\n            </div>\n            \n            {onShowcase && (\n              <Button\n                variant={userAchievement.is_showcased ? \"default\" : \"outline\"}\n                size=\"sm\"\n                className=\"w-full text-xs\"\n                onClick={() => onShowcase(achievementData.id, !userAchievement.is_showcased)}\n                disabled={isShowcasing}\n              >\n                {isShowcasing ? (\n                  <RefreshCw className=\"h-3 w-3 mr-1 animate-spin\" />\n                ) : userAchievement.is_showcased ? (\n                  <Eye className=\"h-3 w-3 mr-1\" />\n                ) : (\n                  <EyeOff className=\"h-3 w-3 mr-1\" />\n                )}\n                {userAchievement.is_showcased ? 'Showcased' : 'Showcase'}\n              </Button>\n            )}\n          </div>\n        )}\n        \n        {achievementData.is_seasonal && achievementData.season_end && (\n          <div className=\"flex items-center gap-2 p-2 bg-orange-50 rounded text-xs text-orange-700\">\n            <Calendar className=\"h-3 w-3\" />\n            <span>Ends {new Date(achievementData.season_end).toLocaleDateString()}</span>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n\ninterface QuestCardProps {\n  quest: Quest;\n  onStart?: (questId: number) => void;\n  isStarting?: boolean;\n}\n\nconst QuestCard: React.FC<QuestCardProps> = ({ quest, onStart, isStarting = false }) => {\n  const progress = quest.user_progress;\n  const canStart = quest.is_available && !progress;\n  const isActive = progress && progress.status === 'in_progress';\n  const isCompleted = progress && progress.status === 'completed';\n  \n  const difficultyColors = {\n    easy: 'text-green-600 bg-green-50',\n    medium: 'text-yellow-600 bg-yellow-50',\n    hard: 'text-orange-600 bg-orange-50',\n    expert: 'text-red-600 bg-red-50'\n  };\n\n  return (\n    <Card className={`transition-all hover:shadow-md ${\n      isCompleted ? 'bg-gradient-to-br from-green-50 to-emerald-50 border-green-300' :\n      isActive ? 'bg-gradient-to-br from-blue-50 to-cyan-50 border-blue-300' :\n      'border-gray-200'\n    }`}>\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 rounded-full bg-gradient-to-br from-purple-100 to-violet-100\">\n              <Target className=\"h-6 w-6 text-purple-600\" />\n            </div>\n            <div>\n              <CardTitle className=\"text-sm font-semibold\">{quest.title}</CardTitle>\n              <CardDescription className=\"text-xs\">\n                {quest.challenge_type} • {quest.difficulty}\n              </CardDescription>\n            </div>\n          </div>\n          \n          <Badge \n            variant=\"outline\" \n            className={difficultyColors[quest.difficulty as keyof typeof difficultyColors]}\n          >\n            {quest.completion_points} pts\n          </Badge>\n        </div>\n      </CardHeader>\n      \n      <CardContent className=\"space-y-3\">\n        <p className=\"text-sm text-gray-600 leading-relaxed\">\n          {quest.description}\n        </p>\n        \n        {progress && (\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between text-xs\">\n              <span className=\"text-gray-600\">Progress</span>\n              <span className=\"font-medium\">{progress.completion_percentage.toFixed(0)}%</span>\n            </div>\n            <Progress value={progress.completion_percentage} className=\"h-2\" />\n            \n            {isCompleted && (\n              <div className=\"flex items-center gap-2 p-2 bg-green-50 rounded text-xs text-green-700\">\n                <CheckCircle className=\"h-3 w-3\" />\n                <span>Completed {new Date(progress.completed_at!).toLocaleDateString()}</span>\n              </div>\n            )}\n          </div>\n        )}\n        \n        <div className=\"flex items-center justify-between text-xs text-gray-500\">\n          <span className=\"flex items-center gap-1\">\n            <Clock className=\"h-3 w-3\" />\n            Ends {new Date(quest.end_date).toLocaleDateString()}\n          </span>\n          <span className=\"flex items-center gap-1\">\n            <Users className=\"h-3 w-3\" />\n            {quest.current_participants} participants\n          </span>\n        </div>\n        \n        {canStart && onStart && (\n          <Button\n            size=\"sm\"\n            className=\"w-full\"\n            onClick={() => onStart(quest.id)}\n            disabled={isStarting}\n          >\n            {isStarting ? (\n              <RefreshCw className=\"h-3 w-3 mr-2 animate-spin\" />\n            ) : (\n              <Target className=\"h-3 w-3 mr-2\" />\n            )}\n            Start Quest\n          </Button>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n\nconst EnhancedAchievementDashboard: React.FC = () => {\n  const {\n    achievements,\n    earnedAchievements,\n    summary,\n    streak,\n    points,\n    quests,\n    loading,\n    errors,\n    loadAchievements,\n    loadEarnedAchievements,\n    loadQuests,\n    updateStreak,\n    showcaseAchievement,\n    startQuest,\n    refreshAll,\n    clearError\n  } = useAchievements();\n  \n  const { toast } = useToast();\n  const [showcasingId, setShowcasingId] = useState<number | null>(null);\n  const [startingQuestId, setStartingQuestId] = useState<number | null>(null);\n  const [activeTab, setActiveTab] = useState('overview');\n\n  // Load initial data\n  useEffect(() => {\n    loadAchievements();\n    loadEarnedAchievements();\n    loadQuests();\n  }, []);\n\n  const handleShowcase = async (achievementId: number, showcase: boolean) => {\n    setShowcasingId(achievementId);\n    try {\n      await showcaseAchievement(achievementId, showcase);\n      toast({\n        title: showcase ? \"Achievement showcased\" : \"Achievement removed from showcase\",\n        description: \"Your profile has been updated.\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: ApiErrorHandler.getDisplayMessage(error),\n        variant: \"destructive\",\n      });\n    } finally {\n      setShowcasingId(null);\n    }\n  };\n\n  const handleStartQuest = async (questId: number) => {\n    setStartingQuestId(questId);\n    try {\n      await startQuest(questId);\n      toast({\n        title: \"Quest started!\",\n        description: \"Good luck on your new quest!\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error starting quest\",\n        description: ApiErrorHandler.getDisplayMessage(error),\n        variant: \"destructive\",\n      });\n    } finally {\n      setStartingQuestId(null);\n    }\n  };\n\n  const handleUpdateStreak = async () => {\n    try {\n      const result = await updateStreak();\n      if (result.new_achievements.length > 0 || result.new_milestones.length > 0) {\n        toast({\n          title: \"Congratulations!\",\n          description: `You earned ${result.new_achievements.length} achievements and ${result.new_milestones.length} milestones!`,\n        });\n      } else {\n        toast({\n          title: \"Streak updated\",\n          description: \"Keep up the great work!\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Error updating streak\",\n        description: ApiErrorHandler.getDisplayMessage(error),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Error handling\n  const hasError = Object.values(errors).some(error => error !== null);\n  const isLoading = Object.values(loading).some(loading => loading);\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Achievements</h1>\n          <p className=\"text-gray-600 mt-1\">Track your learning progress and unlock rewards</p>\n        </div>\n        \n        <div className=\"flex items-center gap-3\">\n          <Button \n            variant=\"outline\" \n            onClick={refreshAll}\n            disabled={isLoading}\n          >\n            <RefreshCw className={`h-4 w-4 mr-2 ${isLoading ? 'animate-spin' : ''}`} />\n            Refresh\n          </Button>\n          \n          <Button \n            onClick={handleUpdateStreak}\n            disabled={loading.actions}\n          >\n            <Flame className=\"h-4 w-4 mr-2\" />\n            Update Streak\n          </Button>\n        </div>\n      </div>\n\n      {/* Error Display */}\n      {hasError && (\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertDescription>\n            Some data couldn't be loaded. Please try refreshing.\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {/* Quick Stats */}\n      {(points || streak || summary) && (\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          {points && (\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <Star className=\"h-8 w-8 text-yellow-500\" />\n                  <div>\n                    <p className=\"text-2xl font-bold\">{points.total_points.toLocaleString()}</p>\n                    <p className=\"text-sm text-gray-600\">Total Points</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n          \n          {streak && (\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <Flame className=\"h-8 w-8 text-orange-500\" />\n                  <div>\n                    <p className=\"text-2xl font-bold\">{streak.current_streak}</p>\n                    <p className=\"text-sm text-gray-600\">Day Streak</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n          \n          {points && (\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <TrendingUp className=\"h-8 w-8 text-blue-500\" />\n                  <div>\n                    <p className=\"text-2xl font-bold\">{points.current_level}</p>\n                    <p className=\"text-sm text-gray-600\">Level</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n          \n          {summary && (\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <Trophy className=\"h-8 w-8 text-purple-500\" />\n                  <div>\n                    <p className=\"text-2xl font-bold\">{summary.achievements.total_earned}</p>\n                    <p className=\"text-sm text-gray-600\">Achievements</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n      )}\n\n      {/* Main Content */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n          <TabsTrigger value=\"achievements\">All Achievements</TabsTrigger>\n          <TabsTrigger value=\"earned\">Earned</TabsTrigger>\n          <TabsTrigger value=\"quests\">Quests</TabsTrigger>\n        </TabsList>\n        \n        <TabsContent value=\"overview\" className=\"space-y-6\">\n          {/* Level Progress */}\n          {points && (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Zap className=\"h-5 w-5 text-blue-500\" />\n                  Level Progress\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium\">Level {points.current_level}</span>\n                  <span className=\"text-sm text-gray-600\">\n                    {points.total_xp} / {points.total_xp + points.xp_to_next_level} XP\n                  </span>\n                </div>\n                <Progress \n                  value={(points.total_xp / (points.total_xp + points.xp_to_next_level)) * 100} \n                  className=\"h-3\"\n                />\n              </CardContent>\n            </Card>\n          )}\n          \n          {/* Recent Achievements */}\n          {summary?.achievements.recent && summary.achievements.recent.length > 0 && (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Award className=\"h-5 w-5 text-green-500\" />\n                  Recent Achievements\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {summary.achievements.recent.slice(0, 6).map((achievement) => (\n                    <AchievementCard\n                      key={achievement.id}\n                      achievement={achievement}\n                      isEarned={true}\n                      onShowcase={handleShowcase}\n                      isShowcasing={showcasingId === achievement.achievement.id}\n                    />\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          )}\n          \n          {/* Active Quests */}\n          {quests.filter(q => q.user_progress?.status === 'in_progress').length > 0 && (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Target className=\"h-5 w-5 text-purple-500\" />\n                  Active Quests\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  {quests\n                    .filter(q => q.user_progress?.status === 'in_progress')\n                    .map((quest) => (\n                      <QuestCard\n                        key={quest.id}\n                        quest={quest}\n                        onStart={handleStartQuest}\n                        isStarting={startingQuestId === quest.id}\n                      />\n                    ))\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n        \n        <TabsContent value=\"achievements\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>All Achievements</CardTitle>\n              <CardDescription>\n                Discover all available achievements and work towards unlocking them.\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {loading.achievements ? (\n                <div className=\"text-center py-8\">\n                  <RefreshCw className=\"h-8 w-8 animate-spin mx-auto text-gray-400\" />\n                  <p className=\"mt-2 text-gray-600\">Loading achievements...</p>\n                </div>\n              ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {achievements.map((achievement) => {\n                    const isEarned = earnedAchievements.some(\n                      ua => ua.achievement.id === achievement.id\n                    );\n                    return (\n                      <AchievementCard\n                        key={achievement.id}\n                        achievement={achievement}\n                        isEarned={isEarned}\n                      />\n                    );\n                  })}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n        \n        <TabsContent value=\"earned\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Earned Achievements</CardTitle>\n              <CardDescription>\n                Your collection of earned achievements. Manage which ones to showcase on your profile.\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {loading.earnedAchievements ? (\n                <div className=\"text-center py-8\">\n                  <RefreshCw className=\"h-8 w-8 animate-spin mx-auto text-gray-400\" />\n                  <p className=\"mt-2 text-gray-600\">Loading earned achievements...</p>\n                </div>\n              ) : earnedAchievements.length === 0 ? (\n                <div className=\"text-center py-8\">\n                  <Trophy className=\"h-12 w-12 mx-auto text-gray-400\" />\n                  <p className=\"mt-2 text-gray-600\">No achievements earned yet</p>\n                  <p className=\"text-sm text-gray-500\">Start learning to unlock your first achievement!</p>\n                </div>\n              ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {earnedAchievements.map((userAchievement) => (\n                    <AchievementCard\n                      key={userAchievement.id}\n                      achievement={userAchievement}\n                      isEarned={true}\n                      onShowcase={handleShowcase}\n                      isShowcasing={showcasingId === userAchievement.achievement.id}\n                    />\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n        \n        <TabsContent value=\"quests\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Available Quests</CardTitle>\n              <CardDescription>\n                Take on special challenges to earn bonus points and exclusive rewards.\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {loading.quests ? (\n                <div className=\"text-center py-8\">\n                  <RefreshCw className=\"h-8 w-8 animate-spin mx-auto text-gray-400\" />\n                  <p className=\"mt-2 text-gray-600\">Loading quests...</p>\n                </div>\n              ) : quests.length === 0 ? (\n                <div className=\"text-center py-8\">\n                  <Target className=\"h-12 w-12 mx-auto text-gray-400\" />\n                  <p className=\"mt-2 text-gray-600\">No quests available</p>\n                  <p className=\"text-sm text-gray-500\">Check back later for new challenges!</p>\n                </div>\n              ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {quests.map((quest) => (\n                    <QuestCard\n                      key={quest.id}\n                      quest={quest}\n                      onStart={handleStartQuest}\n                      isStarting={startingQuestId === quest.id}\n                    />\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n};\n\nexport default EnhancedAchievementDashboard;